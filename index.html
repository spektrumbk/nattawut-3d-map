<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Train Journey (Morning) | AI Spektrum</title>
    <style>
        :root {
            --accent: #2e7d32;
            /* Green for morning theme */
            --bg: #a5f3fc;
            /* Sky blue */
            --panel: rgba(255, 255, 255, 0.9);
        }

        body {
            margin: 0;
            overflow: hidden;
            background: var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        canvas {
            display: block;
        }

        #ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 20px;
            background: var(--panel);
            color: #333;
            border-radius: 12px;
            border: 1px solid #ddd;
            backdrop-filter: blur(8px);
            width: 280px;
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .label {
            color: #666;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .value {
            font-weight: 600;
            color: var(--accent);
        }

        .locality {
            font-size: 1.2rem;
            margin-bottom: 12px;
            display: block;
            color: #111;
        }

        #footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #555;
            font-size: 0.75rem;
            pointer-events: none;
        }

        .oracle-branding {
            color: var(--accent);
            font-weight: bold;
        }

        #controls-hint {
            position: absolute;
            bottom: 60px;
            right: 20px;
            background: var(--panel);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #666;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body>
    <div id="ui-overlay">
        <span class="label">Current Location</span>
        <span id="locality" class="locality">Initializing...</span>

        <div class="status-row">
            <span class="label">Time</span>
            <span id="time" class="value">--:--</span>
        </div>
        <div class="status-row">
            <span class="label">Battery</span>
            <span id="battery" class="value">--%</span>
        </div>
        <div class="status-row">
            <span class="label">View</span>
            <span class="value">Follow POV</span>
        </div>
    </div>

    <div id="controls-hint">
        Auto-Pilot: Riding on top!
    </div>

    <footer id="footer">
        Powered by <span class="oracle-branding">AI Spektrum</span> ðŸ”®
    </footer>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // GPS Data
        const journeyData = [
            { lat: 18.464717, lon: 99.05675, locality: "Mueang Lamphun", updated: "08:04", battery: 80 },
            { lat: 18.456107, lon: 99.087873, locality: "Mae Tha District", updated: "08:14", battery: 78 },
            { lat: 18.392756, lon: 99.265662, locality: "Hang Chat District", updated: "09:01", battery: 69 },
            { lat: 18.312283, lon: 99.413179, locality: "Mueang Lampang", updated: "09:22", battery: 64 },
            { lat: 18.264667, lon: 99.709782, locality: "Mae Mo District", updated: "09:58", battery: 55 },
            { lat: 18.211666, lon: 99.871989, locality: "Long District", updated: "10:29", battery: 49 },
            { lat: 18.096358, lon: 99.866883, locality: "Ban Pin Station", updated: "10:49", battery: 46 },
            { lat: 17.97274, lon: 100.052057, locality: "Den Chai District", updated: "11:31", battery: 38 },
            { lat: 17.839016, lon: 100.046134, locality: "Mueang Uttaradit", updated: "11:47", battery: 34 },
            { lat: 17.652857, lon: 100.122463, locality: "Tha Sao (Sila At)", updated: "12:07", battery: 30 },
            { lat: 16.817458, lon: 100.25806, locality: "PSRU (Campus)", updated: "16:23", battery: 1 },
            { lat: 16.813947, lon: 100.263612, locality: "Phitsanulok City", updated: "18:27", battery: 1 }
        ];

        // Scene Setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xb9e2f5); // Brighter Sky
        scene.fog = new THREE.Fog(0xb9e2f5, 100, 1500);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
        sunLight.position.set(100, 200, 100);
        scene.add(sunLight);

        // Ground Plane (Grass)
        const groundGeo = new THREE.PlaneGeometry(10000, 10000);
        const groundMat = new THREE.MeshPhongMaterial({ color: 0x4caf50 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -1; // Slightly below rails
        scene.add(ground);

        // Coordinate Conversion
        function latLonToVector3(lat, lon) {
            const scale = 300; // Adjusted scale for better perspective
            const originLat = 17.6;
            const originLon = 99.8;
            const x = (lon - originLon) * scale;
            const z = (originLat - lat) * scale * 1.05;
            return new THREE.Vector3(x, 0, z);
        }

        // Create Path
        const curvePoints = journeyData.map(d => latLonToVector3(d.lat, d.lon));
        const curve = new THREE.CatmullRomCurve3(curvePoints);

        // Render Rails (Double Line)
        const railOffset = 0.8;
        const mainLinePoints = curve.getSpacedPoints(1000);

        const createRail = (offset) => {
            const points = mainLinePoints.map((p, i) => {
                const tangent = curve.getTangentAt(i / 1000);
                const normal = new THREE.Vector3(-tangent.z, 0, tangent.x).normalize();
                return p.clone().add(normal.multiplyScalar(offset));
            });
            const geo = new THREE.BufferGeometry().setFromPoints(points);
            const mat = new THREE.LineBasicMaterial({ color: 0x888888 });
            return new THREE.Line(geo, mat);
        };

        scene.add(createRail(railOffset));
        scene.add(createRail(-railOffset));

        // Train Model (Improved)
        const trainGroup = new THREE.Group();

        const bodyGeo = new THREE.BoxGeometry(2.5, 3, 8);
        const bodyMat = new THREE.MeshPhongMaterial({ color: 0x333333 });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        trainGroup.add(body);

        const cabinGeo = new THREE.BoxGeometry(2.4, 1.5, 3);
        const cabinMat = new THREE.MeshPhongMaterial({ color: 0x555555 });
        const cabin = new THREE.Mesh(cabinGeo, cabinMat);
        cabin.position.set(0, 2, -1);
        trainGroup.add(cabin);

        const stripeGeo = new THREE.BoxGeometry(2.6, 0.4, 8.1);
        const stripeMat = new THREE.MeshPhongMaterial({ color: 0xffcc00 });
        const stripe = new THREE.Mesh(stripeGeo, stripeMat);
        stripe.position.y = 0;
        trainGroup.add(stripe);

        scene.add(trainGroup);

        // UI Updates
        const uiLocality = document.getElementById('locality');
        const uiTime = document.getElementById('time');
        const uiBattery = document.getElementById('battery');

        function updateUI(t) {
            const index = Math.floor(t * (journeyData.length - 1));
            const data = journeyData[index];
            uiLocality.innerText = data.locality;
            uiTime.innerText = data.updated;
            uiBattery.innerText = data.battery + '%';
        }

        // Animation Loop
        let progress = 0;
        const speed = 0.0003;

        function animate() {
            requestAnimationFrame(animate);

            progress += speed;
            if (progress > 1) progress = 0;

            const pos = curve.getPointAt(progress);
            const tangent = curve.getTangentAt(progress);

            trainGroup.position.copy(pos);
            trainGroup.lookAt(pos.clone().add(tangent));

            // Camera follow - Further back and higher for 3rd person
            const camOffset = new THREE.Vector3(0, 15, -35).applyQuaternion(trainGroup.quaternion);
            const camTarget = new THREE.Vector3(0, 0, 10).applyQuaternion(trainGroup.quaternion);

            camera.position.copy(pos.clone().add(camOffset));
            camera.lookAt(pos.clone().add(camTarget));

            updateUI(progress);
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>

</html>