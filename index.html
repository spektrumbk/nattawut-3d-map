<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Train Journey | AI Spektrum</title>
    <style>
        :root {
            --accent: #58a6ff;
            --bg: #0d1117;
            --panel: rgba(22, 27, 34, 0.85);
        }

        body {
            margin: 0;
            overflow: hidden;
            background: var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        canvas {
            display: block;
        }

        #ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 20px;
            background: var(--panel);
            color: #c9d1d9;
            border-radius: 12px;
            border: 1px solid #30363d;
            backdrop-filter: blur(8px);
            width: 280px;
            pointer-events: none;
            z-index: 100;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .label {
            color: #8b949e;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .value {
            font-weight: 600;
            color: var(--accent);
        }

        .locality {
            font-size: 1.2rem;
            margin-bottom: 12px;
            display: block;
        }

        #footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #8b949e;
            font-size: 0.75rem;
            pointer-events: none;
        }

        .oracle-branding {
            color: var(--accent);
            font-weight: bold;
        }

        #controls-hint {
            position: absolute;
            bottom: 60px;
            right: 20px;
            background: var(--panel);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #8b949e;
        }
    </style>
</head>

<body>
    <div id="ui-overlay">
        <span class="label">Current Location</span>
        <span id="locality" class="locality">Initializing...</span>

        <div class="status-row">
            <span class="label">Time</span>
            <span id="time" class="value">--:--</span>
        </div>
        <div class="status-row">
            <span class="label">Battery</span>
            <span id="battery" class="value">--%</span>
        </div>
        <div class="status-row">
            <span class="label">Speed</span>
            <span class="value">Express 77</span>
        </div>
    </div>

    <div id="controls-hint">
        Auto-Pilot: Train POV
    </div>

    <footer id="footer">
        Powered by <span class="oracle-branding">AI Spektrum</span> ðŸ”®
    </footer>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // GPS Data
        const journeyData = [
            { lat: 18.464717, lon: 99.05675, locality: "Mueang Lamphun", updated: "08:04", battery: 80 },
            { lat: 18.456107, lon: 99.087873, locality: "Mae Tha District", updated: "08:14", battery: 78 },
            { lat: 18.392756, lon: 99.265662, locality: "Hang Chat District", updated: "09:01", battery: 69 },
            { lat: 18.312283, lon: 99.413179, locality: "Mueang Lampang", updated: "09:22", battery: 64 },
            { lat: 18.264667, lon: 99.709782, locality: "Mae Mo District", updated: "09:58", battery: 55 },
            { lat: 18.211666, lon: 99.871989, locality: "Long District", updated: "10:29", battery: 49 },
            { lat: 18.096358, lon: 99.866883, locality: "Ban Pin Station", updated: "10:49", battery: 46 },
            { lat: 17.97274, lon: 100.052057, locality: "Den Chai District", updated: "11:31", battery: 38 },
            { lat: 17.839016, lon: 100.046134, locality: "Mueang Uttaradit", updated: "11:47", battery: 34 },
            { lat: 17.652857, lon: 100.122463, locality: "Tha Sao (Sila At)", updated: "12:07", battery: 30 },
            { lat: 16.817458, lon: 100.25806, locality: "PSRU (Campus)", updated: "16:23", battery: 1 },
            { lat: 16.813947, lon: 100.263612, locality: "Phitsanulok City", updated: "18:27", battery: 1 }
        ];

        // Scene Setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        scene.fog = new THREE.FogExp2(0x050505, 0.002);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // Lights
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);

        // Coordinate Conversion
        function latLonToVector3(lat, lon) {
            const scale = 500; // Scaling factor for the scene
            const originLat = 17.6;
            const originLon = 99.8;

            const x = (lon - originLon) * scale;
            const z = (originLat - lat) * scale * 1.05; // Adjust for aspect ratio
            return new THREE.Vector3(x, 0, z);
        }

        // Create Path
        const curvePoints = journeyData.map(d => latLonToVector3(d.lat, d.lon));
        const curve = new THREE.CatmullRomCurve3(curvePoints);

        const pathGeometry = new THREE.BufferGeometry().setFromPoints(curve.getSpacedPoints(200));
        const pathMaterial = new THREE.LineBasicMaterial({ color: 0x58a6ff, transparent: true, opacity: 0.3 });
        const pathLine = new THREE.Line(pathGeometry, pathMaterial);
        scene.add(pathLine);

        // Stars/Particles for background
        const starGeo = new THREE.BufferGeometry();
        const starCount = 3000;
        const starPos = new Float32Array(starCount * 3);
        for (let i = 0; i < starCount * 3; i++) {
            starPos[i] = (Math.random() - 0.5) * 4000;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7 });
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // Train Model (Simple)
        const trainGroup = new THREE.Group();

        const engineGeo = new THREE.BoxGeometry(2, 2.5, 6);
        const engineMat = new THREE.MeshPhongMaterial({ color: 0x222222 });
        const engine = new THREE.Mesh(engineGeo, engineMat);
        trainGroup.add(engine);

        // Headlight
        const headlight = new THREE.SpotLight(0xffffff, 50, 100, Math.PI / 4, 0.5);
        headlight.position.set(0, 1, 3);
        headlight.target.position.set(0, 0, 10);
        trainGroup.add(headlight);
        trainGroup.add(headlight.target);

        scene.add(trainGroup);

        // UI Updates
        const uiLocality = document.getElementById('locality');
        const uiTime = document.getElementById('time');
        const uiBattery = document.getElementById('battery');

        function updateUI(t) {
            const index = Math.floor(t * (journeyData.length - 1));
            const data = journeyData[index];
            uiLocality.innerText = data.locality;
            uiTime.innerText = data.updated;
            uiBattery.innerText = data.battery + '%';
        }

        // Animation Loop
        let progress = 0;
        const speed = 0.0002;

        function animate() {
            requestAnimationFrame(animate);

            progress += speed;
            if (progress > 1) progress = 0;

            // Position train
            const pos = curve.getPointAt(progress);
            const tangent = curve.getTangentAt(progress);

            trainGroup.position.copy(pos);
            trainGroup.lookAt(pos.clone().add(tangent));

            // Camera follow - On head of train
            const camOffset = new THREE.Vector3(0, 2.5, 2.5).applyQuaternion(trainGroup.quaternion);
            const camTarget = new THREE.Vector3(0, 1, 15).applyQuaternion(trainGroup.quaternion);

            camera.position.copy(pos.clone().add(camOffset));
            camera.lookAt(pos.clone().add(camTarget));

            updateUI(progress);
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>

</html>